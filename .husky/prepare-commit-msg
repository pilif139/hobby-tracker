#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

BRANCH_NAME=$(git branch --show-current)
COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# Skip if amending, merging, or on main/master branch
if [ -z "$COMMIT_SOURCE" ] && [ "$BRANCH_NAME" != "main" ] && [ "$BRANCH_NAME" != "master" ]; then
  # Check if branch name is not already in the message
  if ! grep -q "\[$BRANCH_NAME\]" "$COMMIT_MSG_FILE"; then
    # Prepend branch name to the first non-comment line
    sed -i.bak "1s/^/[$BRANCH_NAME] /" "$COMMIT_MSG_FILE"
  fi
fi